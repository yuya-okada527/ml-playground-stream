service: ml-playground-log-stream-service

provider:
  name: google
  stage: dev
  runtime: python38
  region: asia-northeast1
  project: ml-playground-306716
  credentials: ${env:CREDENTIALS_PATH}
  # TODO ローカルでも環境変数を利用する
  # credentials: ~/.gcloud/keys/ml-playground-log-stream.json

frameworkVersion: "2"
plugins:
  - serverless-google-cloudfunctions
  - serverless-python-requirements
package:
  exclude:
    - node_modules/**
    - .gitignore
    - .git/**

functions:
  extract:
    handler: extract_logs
    events:
      - event:
          eventType: providers/cloud.pubsub/eventTypes/topic.publish
          resource: projects/ml-playground-306716/topics/ml-playground-log-export-topic
#   third:
#     handler: subscribe
#     events:
#       - event:
#           eventType: providers/cloud.pubsub/eventTypes/topic.publish
#           resource: projects/ml-playground-306716/topics/sample-publish-topic
#   # NOTE: the following uses an "event" event (pubSub event in this case).
# Please create the corresponding resources in the Google Cloud
# before deploying this service through Serverless
#second:
#  handler: event
#  events:
#    - event:
#        eventType: providers/cloud.pubsub/eventTypes/topic.publish
#        resource: projects/*/topics/my-topic
# you can define resources, templates etc. the same way you would in a
# Google Cloud deployment configuration
#resources:
#  resources:
#    - type: storage.v1.bucket
#      name: my-serverless-service-bucket
#  imports:
#    - path: my_template.jinja

custom:
  pythonRequirements:
    pythonBin: python3
